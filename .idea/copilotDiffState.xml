<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/services/school-springboot/student-service/Dockerfile">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/services/school-springboot/student-service/Dockerfile" />
              <option name="originalContent" value="FROM maven:3.9.4-eclipse-temurin-17 AS build&#10;WORKDIR /app&#10;&#10;# Copy the multi-module parent POM and the student-service module into the build context&#10;# We expect the build context to be the repository root so these paths exist.&#10;COPY services/school-springboot/pom.xml ./pom.xml&#10;COPY services/school-springboot/student-service/pom.xml ./student-service/pom.xml&#10;COPY services/school-springboot/student-service/src ./student-service/src&#10;&#10;# Build the student-service module only (skip tests for faster local builds)&#10;RUN mvn -B -f student-service/pom.xml -DskipTests package&#10;&#10;# runtime image&#10;FROM eclipse-temurin:17-jdk&#10;WORKDIR /app&#10;ARG JAR_FILE=student-service/target/*.jar&#10;COPY --from=build /app/${JAR_FILE} app.jar&#10;# copy the entrypoint that waits for dependencies&#10;COPY services/school-springboot/student-service/entrypoint.sh ./entrypoint.sh&#10;RUN chmod +x ./entrypoint.sh&#10;&#10;EXPOSE 8083&#10;ENTRYPOINT [&quot;./entrypoint.sh&quot;]&#10;" />
              <option name="updatedContent" value="FROM maven:3.9.4-eclipse-temurin-17 AS build&#10;WORKDIR /app&#10;&#10;# Copy the multi-module parent POM and the student-service module into the build context&#10;# We expect the build context to be the repository root so these paths exist.&#10;COPY services/school-springboot/pom.xml ./pom.xml&#10;COPY services/school-springboot/student-service/pom.xml ./student-service/pom.xml&#10;COPY services/school-springboot/student-service/src ./student-service/src&#10;&#10;# Build the student-service module only (skip tests for faster local builds)&#10;RUN mvn -B -f student-service/pom.xml -DskipTests package&#10;&#10;# runtime image&#10;FROM eclipse-temurin:17-jdk&#10;WORKDIR /app&#10;ARG JAR_FILE=student-service/target/*.jar&#10;COPY --from=build /app/${JAR_FILE} app.jar&#10;# copy the entrypoint that waits for dependencies&#10;COPY services/school-springboot/student-service/entrypoint.sh ./entrypoint.sh&#10;RUN chmod +x ./entrypoint.sh&#10;&#10;# Ensure the Spring Boot app uses the same port we expose and map on the host&#10;ENV SERVER_PORT=8083&#10;&#10;EXPOSE 8083&#10;ENTRYPOINT [&quot;./entrypoint.sh&quot;]" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/services/school-springboot/student-service/entrypoint.sh">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/services/school-springboot/student-service/entrypoint.sh" />
              <option name="originalContent" value="#!/usr/bin/env bash&#10;set -euo pipefail&#10;&#10;# Defaults (can be overridden via env vars)&#10;POSTGRES_HOST=${POSTGRES_HOST:-postgres}&#10;POSTGRES_PORT=${POSTGRES_PORT:-5432}&#10;EUREKA_URL=${EUREKA_CLIENT_SERVICE_URL:-http://eureka-server:8761/eureka}&#10;&#10;# helper to extract host and port from URL (defaults eureka port to 8761 if absent)&#10;_extract_eureka_host_port() {&#10;  local url=$1&#10;  # remove protocol&#10;  local stripped=${url#*://}&#10;  # get host:port or host&#10;  local hostport=${stripped%%/*}&#10;  if [[ $hostport == *&quot;:&quot;* ]]; then&#10;    echo &quot;$hostport&quot;&#10;  else&#10;    echo &quot;${hostport}:8761&quot;&#10;  fi&#10;}&#10;&#10;EUREKA_HOST_PORT=$(_extract_eureka_host_port &quot;$EUREKA_URL&quot;)&#10;EUREKA_HOST=${EUREKA_HOST_PORT%%:*}&#10;EUREKA_PORT=${EUREKA_HOST_PORT##*:}&#10;&#10;wait_for_tcp() {&#10;  local host=$1; local port=$2&#10;  printf 'Waiting for %s:%s' &quot;$host&quot; &quot;$port&quot;&#10;  while ! (&lt;/dev/tcp/$host/$port) &gt;/dev/null 2&gt;&amp;1; do&#10;    printf '.'; sleep 1&#10;  done&#10;  printf &quot;\n%s:%s is available\n&quot; &quot;$host&quot; &quot;$port&quot;&#10;}&#10;&#10;# Wait for Postgres&#10;wait_for_tcp &quot;$POSTGRES_HOST&quot; &quot;$POSTGRES_PORT&quot;&#10;# Wait for Eureka&#10;wait_for_tcp &quot;$EUREKA_HOST&quot; &quot;$EUREKA_PORT&quot;&#10;&#10;# Exec the jar&#10;exec java -jar /app/app.jar&#10;&#10;" />
              <option name="updatedContent" value="#!/usr/bin/env bash&#10;set -euo pipefail&#10;&#10;# Defaults (can be overridden via env vars)&#10;POSTGRES_HOST=${POSTGRES_HOST:-postgres}&#10;POSTGRES_PORT=${POSTGRES_PORT:-5432}&#10;POSTGRES_DB=${POSTGRES_DB:-oais-student-service}&#10;POSTGRES_USER=${POSTGRES_USER:-postgres}&#10;POSTGRES_PASSWORD=${POSTGRES_PASSWORD:-NewPost}&#10;EUREKA_URL=${EUREKA_CLIENT_SERVICE_URL:-http://eureka-server:8761/eureka}&#10;&#10;# export values so they are visible to the Java process we exec below&#10;export POSTGRES_HOST POSTGRES_PORT POSTGRES_DB POSTGRES_USER POSTGRES_PASSWORD EUREKA_CLIENT_SERVICE_URL=${EUREKA_URL}&#10;&#10;# helper to extract host and port from URL (defaults eureka port to 8761 if absent)&#10;_extract_eureka_host_port() {&#10;  local url=$1&#10;  # remove protocol&#10;  local stripped=${url#*://}&#10;  # get host:port or host&#10;  local hostport=${stripped%%/*}&#10;  if [[ $hostport == *&quot;:&quot;* ]]; then&#10;    echo &quot;$hostport&quot;&#10;  else&#10;    echo &quot;${hostport}:8761&quot;&#10;  fi&#10;}&#10;&#10;EUREKA_HOST_PORT=$(_extract_eureka_host_port &quot;$EUREKA_URL&quot;)&#10;EUREKA_HOST=${EUREKA_HOST_PORT%%:*}&#10;EUREKA_PORT=${EUREKA_HOST_PORT##*:}&#10;&#10;# If SPRING_DATASOURCE_URL was not provided, construct it from the above values&#10;if [[ -z &quot;${SPRING_DATASOURCE_URL:-}&quot; ]]; then&#10;  export SPRING_DATASOURCE_URL=&quot;jdbc:postgresql://${POSTGRES_HOST}:${POSTGRES_PORT}/${POSTGRES_DB}&quot;&#10;fi&#10;# Ensure the JVM sees the datasource credentials&#10;export SPRING_DATASOURCE_USERNAME=${SPRING_DATASOURCE_USERNAME:-$POSTGRES_USER}&#10;export SPRING_DATASOURCE_PASSWORD=${SPRING_DATASOURCE_PASSWORD:-$POSTGRES_PASSWORD}&#10;&#10;wait_for_tcp() {&#10;  local host=$1; local port=$2&#10;  printf 'Waiting for %s:%s' &quot;$host&quot; &quot;$port&quot;&#10;  while ! (&lt;/dev/tcp/$host/$port) &gt;/dev/null 2&gt;&amp;1; do&#10;    printf '.'; sleep 1&#10;  done&#10;  printf &quot;\n%s:%s is available\n&quot; &quot;$host&quot; &quot;$port&quot;&#10;}&#10;&#10;# Wait for Postgres&#10;wait_for_tcp &quot;$POSTGRES_HOST&quot; &quot;$POSTGRES_PORT&quot;&#10;# Wait for Eureka&#10;wait_for_tcp &quot;$EUREKA_HOST&quot; &quot;$EUREKA_PORT&quot;&#10;&#10;# Exec the jar&#10;exec java -jar /app/app.jar" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>